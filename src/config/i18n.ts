import { I18nConfig, SupportedLanguage, TranslationNamespace } from '@/types/i18n.types';
import { LanguageCode } from '@/types/common.types';

export const supportedLanguages: SupportedLanguage[] = [
  {
    code: 'en',
    name: 'English',
    nativeName: 'English',
    rtl: false,
    enabled: true,
  },
  {
    code: 'es',
    name: 'Spanish',
    nativeName: 'Español',
    rtl: false,
    enabled: true,
  },
  {
    code: 'fr',
    name: 'French',
    nativeName: 'Français',
    rtl: false,
    enabled: true,
  },
  {
    code: 'pt',
    name: 'Portuguese',
    nativeName: 'Português',
    rtl: false,
    enabled: true,
  },
  {
    code: 'hi',
    name: 'Hindi',
    nativeName: 'हिन्दी',
    rtl: false,
    enabled: true,
  },
  {
    code: 'bn',
    name: 'Bengali',
    nativeName: 'বাংলা',
    rtl: false,
    enabled: true,
  },
  {
    code: 'id',
    name: 'Indonesian',
    nativeName: 'Bahasa Indonesia',
    rtl: false,
    enabled: true,
  },
  {
    code: 'vi',
    name: 'Vietnamese',
    nativeName: 'Tiếng Việt',
    rtl: false,
    enabled: true,
  },
];

export const translationNamespaces: TranslationNamespace[] = [
  { key: 'common', description: 'Common UI elements and general terms' },
  { key: 'auth', description: 'Authentication and registration' },
  { key: 'diagnosis', description: 'Plant disease diagnosis' },
  { key: 'crops', description: 'Crop information and management' },
  { key: 'diseases', description: 'Disease descriptions and treatments' },
  { key: 'weather', description: 'Weather conditions and forecasts' },
  { key: 'community', description: 'Community features and interactions' },
  { key: 'experts', description: 'Expert consultation features' },
  { key: 'market', description: 'Market prices and trading' },
  { key: 'notifications', description: 'Push notifications and alerts' },
  { key: 'errors', description: 'Error messages and validation' },
  { key: 'navigation', description: 'Navigation and menu items' },
];

export const i18nConfig: I18nConfig = {
  defaultLanguage: 'en' as LanguageCode,
  fallbackLanguage: 'en' as LanguageCode,
  supportedLanguages: supportedLanguages.map(lang => lang.code) as LanguageCode[],
  enabledLanguages: supportedLanguages.filter(lang => lang.enabled).map(lang => lang.code) as LanguageCode[],
  namespaces: translationNamespaces.map(ns => ns.key),
  autoDetectLanguage: process.env.I18N_AUTO_DETECT === 'true',
  cacheTranslations: process.env.NODE_ENV === 'production',
  loadPath: process.env.I18N_LOAD_PATH || 'locales/{{lng}}/{{ns}}.json',
  missingKeyHandler: process.env.I18N_LOG_MISSING === 'true' ? 'log' : 'ignore',
  interpolation: {
    escapeValue: false, // React already escapes values
    formatSeparator: ',',
  },
};

// Default translations for common terms
export const defaultTranslations: Record<LanguageCode, Record<string, Record<string, string>>> = {
  en: {
    common: {
      welcome: 'Welcome',
      loading: 'Loading...',
      error: 'Error',
      success: 'Success',
      cancel: 'Cancel',
      submit: 'Submit',
      save: 'Save',
      delete: 'Delete',
      edit: 'Edit',
      view: 'View',
      back: 'Back',
      next: 'Next',
      previous: 'Previous',
      yes: 'Yes',
      no: 'No',
      ok: 'OK',
    },
    auth: {
      login: 'Login',
      register: 'Register',
      logout: 'Logout',
      email: 'Email',
      password: 'Password',
      confirmPassword: 'Confirm Password',
      forgotPassword: 'Forgot Password?',
      resetPassword: 'Reset Password',
      loginSuccess: 'Logged in successfully',
      logoutSuccess: 'Logged out successfully',
      invalidCredentials: 'Invalid email or password',
    },
    crops: {
      rice: 'Rice',
      wheat: 'Wheat',
      corn: 'Corn',
      tomato: 'Tomato',
      potato: 'Potato',
      onion: 'Onion',
      cotton: 'Cotton',
      sugarcane: 'Sugarcane',
    },
  },
  es: {
    common: {
      welcome: 'Bienvenido',
      loading: 'Cargando...',
      error: 'Error',
      success: 'Éxito',
      cancel: 'Cancelar',
      submit: 'Enviar',
      save: 'Guardar',
      delete: 'Eliminar',
      edit: 'Editar',
      view: 'Ver',
      back: 'Atrás',
      next: 'Siguiente',
      previous: 'Anterior',
      yes: 'Sí',
      no: 'No',
      ok: 'OK',
    },
    auth: {
      login: 'Iniciar Sesión',
      register: 'Registrarse',
      logout: 'Cerrar Sesión',
      email: 'Correo Electrónico',
      password: 'Contraseña',
      confirmPassword: 'Confirmar Contraseña',
      forgotPassword: '¿Olvidaste tu contraseña?',
      resetPassword: 'Restablecer Contraseña',
      loginSuccess: 'Sesión iniciada correctamente',
      logoutSuccess: 'Sesión cerrada correctamente',
      invalidCredentials: 'Correo electrónico o contraseña inválidos',
    },
    crops: {
      rice: 'Arroz',
      wheat: 'Trigo',
      corn: 'Maíz',
      tomato: 'Tomate',
      potato: 'Papa',
      onion: 'Cebolla',
      cotton: 'Algodón',
      sugarcane: 'Caña de Azúcar',
    },
  },
  fr: {
    common: {
      welcome: 'Bienvenue',
      loading: 'Chargement...',
      error: 'Erreur',
      success: 'Succès',
      cancel: 'Annuler',
      submit: 'Soumettre',
      save: 'Sauvegarder',
      delete: 'Supprimer',
      edit: 'Modifier',
      view: 'Voir',
      back: 'Retour',
      next: 'Suivant',
      previous: 'Précédent',
      yes: 'Oui',
      no: 'Non',
      ok: 'OK',
    },
    auth: {
      login: 'Connexion',
      register: 'S\'inscrire',
      logout: 'Déconnexion',
      email: 'Email',
      password: 'Mot de passe',
      confirmPassword: 'Confirmer le mot de passe',
      forgotPassword: 'Mot de passe oublié?',
      resetPassword: 'Réinitialiser le mot de passe',
      loginSuccess: 'Connexion réussie',
      logoutSuccess: 'Déconnexion réussie',
      invalidCredentials: 'Email ou mot de passe invalide',
    },
    crops: {
      rice: 'Riz',
      wheat: 'Blé',
      corn: 'Maïs',
      tomato: 'Tomate',
      potato: 'Pomme de terre',
      onion: 'Oignon',
      cotton: 'Coton',
      sugarcane: 'Canne à sucre',
    },
  },
  pt: {
    common: {
      welcome: 'Bem-vindo',
      loading: 'Carregando...',
      error: 'Erro',
      success: 'Sucesso',
      cancel: 'Cancelar',
      submit: 'Enviar',
      save: 'Salvar',
      delete: 'Excluir',
      edit: 'Editar',
      view: 'Ver',
      back: 'Voltar',
      next: 'Próximo',
      previous: 'Anterior',
      yes: 'Sim',
      no: 'Não',
      ok: 'OK',
    },
    auth: {
      login: 'Entrar',
      register: 'Registrar',
      logout: 'Sair',
      email: 'Email',
      password: 'Senha',
      confirmPassword: 'Confirmar Senha',
      forgotPassword: 'Esqueceu a senha?',
      resetPassword: 'Redefinir Senha',
      loginSuccess: 'Login realizado com sucesso',
      logoutSuccess: 'Logout realizado com sucesso',
      invalidCredentials: 'Email ou senha inválidos',
    },
    crops: {
      rice: 'Arroz',
      wheat: 'Trigo',
      corn: 'Milho',
      tomato: 'Tomate',
      potato: 'Batata',
      onion: 'Cebola',
      cotton: 'Algodão',
      sugarcane: 'Cana-de-açúcar',
    },
  },
  hi: {
    common: {
      welcome: 'स्वागत',
      loading: 'लोड हो रहा है...',
      error: 'त्रुटि',
      success: 'सफलता',
      cancel: 'रद्द करें',
      submit: 'जमा करें',
      save: 'सेव करें',
      delete: 'हटाएं',
      edit: 'संपादित करें',
      view: 'देखें',
      back: 'वापस',
      next: 'अगला',
      previous: 'पिछला',
      yes: 'हां',
      no: 'नहीं',
      ok: 'ठीक',
    },
    auth: {
      login: 'लॉगिन',
      register: 'रजिस्टर',
      logout: 'लॉगआउट',
      email: 'ईमेल',
      password: 'पासवर्ड',
      confirmPassword: 'पासवर्ड की पुष्टि करें',
      forgotPassword: 'पासवर्ड भूल गए?',
      resetPassword: 'पासवर्ड रीसेट करें',
      loginSuccess: 'सफलतापूर्वक लॉगिन हो गए',
      logoutSuccess: 'सफलतापूर्वक लॉगआउट हो गए',
      invalidCredentials: 'अमान्य ईमेल या पासवर्ड',
    },
    crops: {
      rice: 'चावल',
      wheat: 'गेहूं',
      corn: 'मक्का',
      tomato: 'टमाटर',
      potato: 'आलू',
      onion: 'प्याज',
      cotton: 'कपास',
      sugarcane: 'गन्ना',
    },
  },
  bn: {
    common: {
      welcome: 'স্বাগতম',
      loading: 'লোড হচ্ছে...',
      error: 'ত্রুটি',
      success: 'সাফল্য',
      cancel: 'বাতিল',
      submit: 'জমা দিন',
      save: 'সংরক্ষণ',
      delete: 'মুছুন',
      edit: 'সম্পাদনা',
      view: 'দেখুন',
      back: 'পিছনে',
      next: 'পরবর্তী',
      previous: 'পূর্ববর্তী',
      yes: 'হ্যাঁ',
      no: 'না',
      ok: 'ঠিক আছে',
    },
    auth: {
      login: 'লগইন',
      register: 'নিবন্ধন',
      logout: 'লগআউট',
      email: 'ইমেইল',
      password: 'পাসওয়ার্ড',
      confirmPassword: 'পাসওয়ার্ড নিশ্চিত করুন',
      forgotPassword: 'পাসওয়ার্ড ভুলে গেছেন?',
      resetPassword: 'পাসওয়ার্ড রিসেট',
      loginSuccess: 'সফলভাবে লগইন হয়েছে',
      logoutSuccess: 'সফলভাবে লগআউট হয়েছে',
      invalidCredentials: 'অবৈধ ইমেইল বা পাসওয়ার্ড',
    },
    crops: {
      rice: 'চাল',
      wheat: 'গম',
      corn: 'ভুট্টা',
      tomato: 'টমেটো',
      potato: 'আলু',
      onion: 'পিঁয়াজ',
      cotton: 'তুলা',
      sugarcane: 'আখ',
    },
  },
  id: {
    common: {
      welcome: 'Selamat Datang',
      loading: 'Memuat...',
      error: 'Kesalahan',
      success: 'Berhasil',
      cancel: 'Batal',
      submit: 'Kirim',
      save: 'Simpan',
      delete: 'Hapus',
      edit: 'Edit',
      view: 'Lihat',
      back: 'Kembali',
      next: 'Selanjutnya',
      previous: 'Sebelumnya',
      yes: 'Ya',
      no: 'Tidak',
      ok: 'OK',
    },
    auth: {
      login: 'Masuk',
      register: 'Daftar',
      logout: 'Keluar',
      email: 'Email',
      password: 'Kata Sandi',
      confirmPassword: 'Konfirmasi Kata Sandi',
      forgotPassword: 'Lupa Kata Sandi?',
      resetPassword: 'Reset Kata Sandi',
      loginSuccess: 'Berhasil masuk',
      logoutSuccess: 'Berhasil keluar',
      invalidCredentials: 'Email atau kata sandi tidak valid',
    },
    crops: {
      rice: 'Beras',
      wheat: 'Gandum',
      corn: 'Jagung',
      tomato: 'Tomat',
      potato: 'Kentang',
      onion: 'Bawang Merah',
      cotton: 'Kapas',
      sugarcane: 'Tebu',
    },
  },
  vi: {
    common: {
      welcome: 'Chào mừng',
      loading: 'Đang tải...',
      error: 'Lỗi',
      success: 'Thành công',
      cancel: 'Hủy',
      submit: 'Gửi',
      save: 'Lưu',
      delete: 'Xóa',
      edit: 'Chỉnh sửa',
      view: 'Xem',
      back: 'Quay lại',
      next: 'Tiếp theo',
      previous: 'Trước',
      yes: 'Có',
      no: 'Không',
      ok: 'OK',
    },
    auth: {
      login: 'Đăng nhập',
      register: 'Đăng ký',
      logout: 'Đăng xuất',
      email: 'Email',
      password: 'Mật khẩu',
      confirmPassword: 'Xác nhận mật khẩu',
      forgotPassword: 'Quên mật khẩu?',
      resetPassword: 'Đặt lại mật khẩu',
      loginSuccess: 'Đăng nhập thành công',
      logoutSuccess: 'Đăng xuất thành công',
      invalidCredentials: 'Email hoặc mật khẩu không hợp lệ',
    },
    crops: {
      rice: 'Lúa',
      wheat: 'Lúa mì',
      corn: 'Ngô',
      tomato: 'Cà chua',
      potato: 'Khoai tây',
      onion: 'Hành tây',
      cotton: 'Bông',
      sugarcane: 'Mía',
    },
  },
};

export const getLanguageInfo = (code: LanguageCode): SupportedLanguage | undefined => {
  return supportedLanguages.find(lang => lang.code === code);
};

export const isLanguageSupported = (code: string): code is LanguageCode => {
  return supportedLanguages.some(lang => lang.code === code && lang.enabled);
};

export const detectUserLanguage = (acceptLanguageHeader?: string): LanguageCode => {
  if (!acceptLanguageHeader) {
    return i18nConfig.defaultLanguage;
  }

  const preferredLanguages = acceptLanguageHeader
    .split(',')
    .map(lang => {
      const [code, priority = '1'] = lang.trim().split(';q=');
      return {
        code: code?.toLowerCase().split('-')[0] || 'en',
        priority: parseFloat(priority),
      };
    })
    .sort((a, b) => b.priority - a.priority);

  for (const lang of preferredLanguages) {
    if (lang.code && isLanguageSupported(lang.code)) {
      return lang.code as LanguageCode;
    }
  }

  return i18nConfig.defaultLanguage;
};

export default i18nConfig;